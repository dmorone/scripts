#!/usr/bin/env bash
set -e
set -u

# Default values
EXTENSION=""
FOLDER="."  # Current directory by default

# Function to display the help message
usage() {
  echo "Usage: $0 [-f <folder>] <extension>"
  echo ""
  echo "  -f <folder>    Specify the folder to search in. Defaults to the current directory."
  echo "  <extension>    The file extension to filter by (e.g., txt, log, py)."
  echo ""
  echo "Example:"
  echo "  $0 -f /path/to/files txt"
  echo "  $0 py"
  exit 1
}

# Process command-line arguments
while getopts ":f:" opt; do
  case $opt in
    f)
      FOLDER="$OPTARG"
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      usage
      exit 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      usage
      exit 1
      ;;
  esac
done

shift $((OPTIND-1))

# Check if an extension is provided
if [ -z "$EXTENSION" ]; then
  if [ $# -eq 0 ]; then
    usage
  else
    EXTENSION="$1"
    shift
  fi
fi


# Check if the folder exists
if [ ! -d "$FOLDER" ]; then
  echo "Error: Folder '$FOLDER' does not exist." >&2
  exit 1
fi

# Check if the extension is provided after the folder
if [ -z "$EXTENSION" ]; then
    usage
fi


if [[ "$(uname)" == 'Darwin' ]]; then
   # mac and freebsd do not have -printf option in find
   # use folder if exists, or . as default folder
   find ${folder:-.} -name "*.$extension" -print0 | xargs -0 dirname | sort -u
else
   find ${folder:-.} -name "*.$extension"  -printf '%h\n' | sort -u
fi

exit 0
